# ContentHub 优化检查清单

**使用说明**: 按照优先级逐项完成，完成后打勾 ✅

---

## 🔴 **紧急修复（本周内完成）**

### 安全修复

- [ ] **SQL 注入防护** (30分钟)
  - [ ] 修复搜索功能特殊字符转义
  - [ ] 修复标签筛选 SQL 注入风险
  - [ ] 测试：尝试输入 `%` 和 `_` 字符

- [ ] **CORS 配置限制** (15分钟)
  - [ ] 获取 Chrome 扩展实际 ID
  - [ ] 更新 `backend/main.py` CORS 配置
  - [ ] 删除 `chrome-extension://*` 通配符
  - [ ] 测试：确认扩展仍能访问 API

- [ ] **API 密钥加密** (1小时)
  - [ ] 安装 `cryptography` 包
  - [ ] 创建密钥加密/解密工具
  - [ ] 迁移现有 API 密钥
  - [ ] 更新设置页面保存逻辑
  - [ ] 测试：验证 AI 功能仍正常

- [ ] **文件上传验证** (1小时)
  - [ ] 安装 `python-magic` 包
  - [ ] 添加 MIME 类型验证
  - [ ] 添加文件名清理
  - [ ] 添加 PDF 结构验证
  - [ ] 测试：上传正常 PDF 和恶意文件

- [ ] **图片 URL 白名单** (30分钟)
  - [ ] 创建域名白名单配置
  - [ ] 添加 URL 验证函数
  - [ ] 添加内网地址检测
  - [ ] 更新 OCR API 调用
  - [ ] 测试：从白名单域名下载图片

**预计时间**: 3-4 小时
**完成标准**: 所有安全测试通过

---

## 🟡 **性能优化（下周完成）**

### 数据库优化

- [ ] **添加数据库索引** (30分钟)
  - [ ] 为 `source_type` 添加索引
  - [ ] 为 `created_at` 添加索引
  - [ ] 为 `is_deleted` 添加索引
  - [ ] 创建复合索引
  - [ ] 运行性能测试对比

- [ ] **修复 N+1 查询** (1小时)
  - [ ] 识别所有 N+1 查询
  - [ ] 使用 `joinedload` 优化
  - [ ] 测试查询性能

### 代码质量

- [ ] **细化异常处理** (2小时)
  - [ ] 导入具体的异常类型
  - [ ] 替换所有 `except Exception`
  - [ ] 添加合适的 HTTP 状态码
  - [ ] 改善错误提示信息

- [ ] **拆分大型组件** (3小时)
  - [ ] 创建 `MaterialCard` 子组件
  - [ ] 创建 `MaterialFilters` 子组件
  - [ ] 创建 `StatisticsPanel` 子组件
  - [ ] 创建 `TagManageModal` 子组件
  - [ ] 重构 `Materials.jsx` 主组件
  - [ ] 测试所有功能

- [ ] **修复 React hooks** (1小时)
  - [ ] 使用 `useCallback` 包装函数
  - [ ] 修复 `useEffect` 依赖项
  - [ ] 添加 ESLint 规则检查
  - [ ] 修复所有警告

### Chrome 扩展

- [ ] **限制扩展权限** (15分钟)
  - [ ] 更新 `manifest.json` host_permissions
  - [ ] 删除 `<all_urls>` 通配符
  - [ ] 添加具体的域名列表
  - [ ] 测试所有支持的网站

**预计时间**: 6-8 小时
**完成标准**: 性能提升 40%+，无 React 警告

---

## 🟢 **长期改进（持续进行）**

### 性能提升

- [ ] **虚拟列表实现** (2小时)
  - [ ] 安装 `react-window`
  - [ ] 实现虚拟滚动列表
  - [ ] 测试大数据量（1000+ 条）

- [ ] **添加缓存机制** (2小时)
  - [ ] 创建缓存管理器
  - [ ] 缓存标签列表
  - [ ] 缓存提示词列表
  - [ ] 设置合理的 TTL

- [ ] **骨架屏加载** (1小时)
  - [ ] 设计骨架屏组件
  - [ ] 替换所有 Spin 组件
  - [ ] 优化加载体验

### 代码质量

- [ ] **日志脱敏** (1小时)
  - [ ] 创建日志过滤器
  - [ ] 过滤 API 密钥
  - [ ] 过滤敏感用户数据
  - [ ] 测试日志输出

- [ ] **单元测试** (持续)
  - [ ] 后端 API 测试（pytest）
  - [ ] 前端组件测试（Jest）
  - [ ] E2E 测试（Playwright）
  - [ ] 目标覆盖率：70%+

- [ ] **TypeScript 迁移** (可选)
  - [ ] 配置 TypeScript
  - [ ] 逐步迁移组件
  - [ ] 添加类型定义

**预计时间**: 10+ 小时
**完成标准**: 代码覆盖率 70%+，无性能瓶颈

---

## 📊 **性能测试清单**

### 基准测试

- [ ] 加载 10 条素材
- [ ] 加载 100 条素材
- [ ] 加载 1000 条素材
- [ ] 搜索性能测试
- [ ] 筛选性能测试
- [ ] AI 提炼速度
- [ ] OCR 识别速度

### 目标指标

| 操作 | 目标时间 |
|------|---------|
| 加载 100 条素材 | < 200ms |
| 搜索响应 | < 100ms |
| AI 提炼 | < 2s |
| OCR 识别 | < 1s/张 |
| 插件提取 | < 300ms |

---

## 🔒 **安全测试清单**

### SQL 注入测试

- [ ] 搜索框输入: `%` `_` `'` `"` `--`
- [ ] 标签筛选: 特殊字符
- [ ] 预期：正常处理，无错误

### 文件上传测试

- [ ] 上传正常 PDF
- [ ] 上传重命名的 .exe 文件
- [ ] 上传超大文件
- [ ] 上传特殊文件名（`../../etc/passwd.pdf`）
- [ ] 预期：只允许合法 PDF

### CORS 测试

- [ ] 从允许的域名访问 API
- [ ] 从未授权的扩展访问 API
- [ ] 预期：只允许白名单域名

### API 密钥测试

- [ ] 查看数据库中的密钥字段
- [ ] 查看日志中的密钥记录
- [ ] 预期：密钥已加密，日志已脱敏

---

## 📝 **文档完善清单**

- [ ] API 文档
  - [ ] 所有端点的说明
  - [ ] 请求/响应示例
  - [ ] 错误码说明

- [ ] 部署文档
  - [ ] 环境要求
  - [ ] 安装步骤
  - [ ] 配置说明
  - [ ] 常见问题

- [ ] 开发文档
  - [ ] 项目结构
  - [ ] 开发规范
  - [ ] 贡献指南
  - [ ] 测试指南

---

## ✅ **验收标准**

### 第一阶段（安全）

- [x] 通过所有安全测试
- [ ] 无已知安全漏洞
- [ ] API 密钥已加密
- [ ] CORS 配置正确
- [ ] 文件上传安全

### 第二阶段（性能）

- [ ] 查询速度提升 40%+
- [ ] 无 React 性能警告
- [ ] 组件拆分合理
- [ ] hooks 使用正确

### 第三阶段（质量）

- [ ] 代码覆盖率 70%+
- [ ] 无 ESLint 错误
- [ ] 文档完整
- [ ] 用户体验优秀

---

## 🎯 **本周重点**

### 必须完成

1. ✅ SQL 注入防护
2. ✅ CORS 配置限制
3. ✅ API 密钥加密
4. ✅ 文件上传验证
5. ✅ 图片 URL 白名单

### 建议完成

6. ✅ 数据库索引
7. ✅ 异常处理细化
8. ✅ 扩展权限限制

---

## 📞 **需要帮助？**

如果遇到任何问题，请参考：
- 详细报告：`CODE_REVIEW_REPORT.md`
- 修复示例：报告中的代码片段
- 测试方法：各项测试清单

**推荐修复顺序**：
1. 安全问题（必须）
2. 数据库索引（重要）
3. 代码质量（建议）
4. 性能优化（长期）

---

**创建时间**: 2025-10-26
**最后更新**: 2025-10-26
**维护者**: Claude Code
